<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°æ–‡å­—èµ·ã“ã—</title>
    <link rel="icon" href="https://birdwatcheryt.github.io/image/icon.ico">
    <link rel="stylesheet" type="text/css" href="https://birdwatcheryt.github.io/footer.css">
    <style>
        .app {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        #output {
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 100px;
            margin-top: 10px;
            background: #f9f9f9;
            white-space: pre-wrap;
        }

        button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        select {
            margin: 5px;
            padding: 5px;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <p><a href="../index.html">â†Softwares</a></p>
    <div class="app">
        <h1>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°æ–‡å­—èµ·ã“ã—</h1>

        <label for="languageSelect">è¨€èªã‚’é¸æŠ:</label>
        <select id="languageSelect">
            <option value="ja-JP">æ—¥æœ¬èª</option>
            <option value="en-US">è‹±èªï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰</option>
            <option value="en-GB">è‹±èªï¼ˆã‚¤ã‚®ãƒªã‚¹ï¼‰</option>
            <option value="fr-FR">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
            <option value="de-DE">ãƒ‰ã‚¤ãƒ„èª</option>
            <option value="es-ES">ã‚¹ãƒšã‚¤ãƒ³èªï¼ˆã‚¹ãƒšã‚¤ãƒ³ï¼‰</option>
            <option value="it-IT">ã‚¤ã‚¿ãƒªã‚¢èª</option>
            <option value="nl-NL">ã‚ªãƒ©ãƒ³ãƒ€èª</option>
            <option value="pt-BR">ãƒãƒ«ãƒˆã‚¬ãƒ«èªï¼ˆãƒ–ãƒ©ã‚¸ãƒ«ï¼‰</option>
            <option value="pt-PT">ãƒãƒ«ãƒˆã‚¬ãƒ«èªï¼ˆãƒãƒ«ãƒˆã‚¬ãƒ«ï¼‰</option>
            <option value="zh-CN">ä¸­å›½èªï¼ˆç°¡ä½“å­—ï¼‰</option>
            <option value="zh-TW">ä¸­å›½èªï¼ˆç¹ä½“å­—ï¼‰</option>
            <option value="ko-KR">éŸ“å›½èª</option>
            <option value="ru-RU">ãƒ­ã‚·ã‚¢èª</option>
            <option value="ar-SA">ã‚¢ãƒ©ãƒ“ã‚¢èª</option>
            <option value="hi-IN">ãƒ’ãƒ³ãƒ‡ã‚£ãƒ¼èª</option>
            <option value="th-TH">ã‚¿ã‚¤èª</option>
            <option value="tr-TR">ãƒˆãƒ«ã‚³èª</option>
            <option value="sv-SE">ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èª</option>
            <option value="pl-PL">ãƒãƒ¼ãƒ©ãƒ³ãƒ‰èª</option>
            <option value="no-NO">ãƒãƒ«ã‚¦ã‚§ãƒ¼èª</option>
            <option value="da-DK">ãƒ‡ãƒ³ãƒãƒ¼ã‚¯èª</option>
            <option value="fi-FI">ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰èª</option>
            <option value="cs-CZ">ãƒã‚§ã‚³èª</option>
            <option value="el-GR">ã‚®ãƒªã‚·ãƒ£èª</option>
            <option value="he-IL">ãƒ˜ãƒ–ãƒ©ã‚¤èª</option>
            <option value="id-ID">ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èª</option>
            <option value="ms-MY">ãƒãƒ¬ãƒ¼èª</option>
            <option value="vi-VN">ãƒ™ãƒˆãƒŠãƒ èª</option>
        </select>

        <label for="separatorSelect">åŒºåˆ‡ã‚Šæ–‡å­—ã‚’é¸æŠ:</label>
        <select id="separatorSelect">
            <option value="newline">æ”¹è¡Œ</option>
            <option value="space">ã‚¹ãƒšãƒ¼ã‚¹</option>
            <option value="kuten">ã€‚</option>
            <option value="touten">ã€</option>
            <option value="period">.</option>
            <option value="comma">,</option>
        </select>

        <div id="output"></div>
        <button id="start">ğŸ¤ é–‹å§‹</button>
        <button id="stop" disabled>â¹ åœæ­¢</button>
        <button id="save">ğŸ’¾ ä¿å­˜</button>
        <button id="copy">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
        <button id="clear">ğŸ§¹ ã‚¯ãƒªã‚¢</button>
    </div>

    <script>
        let recognition = null;
        let finalTranscript = "";
        let isRecording = false;
        const output = document.getElementById("output");
        const startButton = document.getElementById("start");
        const stopButton = document.getElementById("stop");
        const saveButton = document.getElementById("save");
        const copyButton = document.getElementById("copy");
        const clearButton = document.getElementById("clear");
        const languageSelect = document.getElementById("languageSelect");
        const separatorSelect = document.getElementById("separatorSelect");

        const separatorMap = {
            'newline': '\n',
            'space': ' ',
            'kuten': 'ã€‚',
            'touten': 'ã€',
            'period': '.',
            'comma': ','
        };

        function getCurrentSeparator() {
            return separatorMap[separatorSelect.value] || '\n';
        }

        function startRecognition() {
            if (isRecording) return;

            const SpeechRecognitionAPI = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognitionAPI) {
                alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚");
                return;
            }

            isRecording = true;
            startButton.disabled = true;
            stopButton.disabled = false;
            languageSelect.disabled = true;

            const separator = getCurrentSeparator();
            let currentText = output.textContent;
            if (currentText && !Object.values(separatorMap).some(sep => currentText.endsWith(sep))) {
                currentText += separator;
            }
            finalTranscript = currentText;

            recognition = new SpeechRecognitionAPI();
            recognition.lang = languageSelect.value;
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                let interimTranscript = "";
                const currentSeparator = getCurrentSeparator();
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        // çµæœãŒç©ºæ–‡å­—ã‚„ç©ºç™½ã®ã¿ã§ãªã„å ´åˆã ã‘ã€åŒºåˆ‡ã‚Šæ–‡å­—ã‚’è¿½åŠ ã™ã‚‹
                        if (transcript.trim() !== '') {
                            finalTranscript += transcript + currentSeparator;
                        }
                    } else {
                        interimTranscript += transcript;
                    }
                }
                output.textContent = finalTranscript + interimTranscript;
            };

            recognition.onend = () => {
                if (isRecording) {
                    recognition.start();
                } else {
                    recognition = null;
                    startButton.disabled = false;
                    stopButton.disabled = true;
                    languageSelect.disabled = false;
                }
            };

            recognition.onerror = (event) => {
                console.error("éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:", event.error);
                if (event.error !== 'no-speech') {
                    isRecording = false;
                }
            };

            recognition.start();
        }

        function stopRecognition() {
            if (recognition) {
                isRecording = false;
                recognition.stop();
            }
        }

        startButton.onclick = startRecognition;
        stopButton.onclick = stopRecognition;

        saveButton.onclick = () => {
            const blob = new Blob([output.textContent], { type: "text/plain;charset=utf-8" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "transcript.txt";
            link.click();
        };

        copyButton.onclick = () => {
            navigator.clipboard.writeText(output.textContent).then(() => {
                const originalText = copyButton.innerHTML;
                copyButton.innerHTML = "âœ… ã‚³ãƒ”ãƒ¼å®Œäº†";
                copyButton.disabled = true;
                setTimeout(() => {
                    copyButton.innerHTML = originalText;
                    copyButton.disabled = false;
                }, 2000);
            }).catch(err => {
                console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ', err);
            });
        };

        clearButton.onclick = () => {
            finalTranscript = "";
            output.textContent = "";
        };
    </script>
    <footer></footer>
</body>

</html>